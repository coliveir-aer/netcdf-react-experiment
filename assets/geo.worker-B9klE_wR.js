(function(){"use strict";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const F=Symbol("Comlink.proxy"),X=Symbol("Comlink.endpoint"),$=Symbol("Comlink.releaseProxy"),S=Symbol("Comlink.finalizer"),b=Symbol("Comlink.thrown"),L=t=>typeof t=="object"&&t!==null||typeof t=="function",B={canHandle:t=>L(t)&&t[F],serialize(t){const{port1:e,port2:n}=new MessageChannel;return k(t,e),[n,[n]]},deserialize(t){return t.start(),Z(t)}},J={canHandle:t=>L(t)&&b in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},H=new Map([["proxy",B],["throw",J]]);function K(t,e){for(const n of t)if(e===n||n==="*"||n instanceof RegExp&&n.test(e))return!0;return!1}function k(t,e=globalThis,n=["*"]){e.addEventListener("message",function g(r){if(!r||!r.data)return;if(!K(n,r.origin)){console.warn(`Invalid origin '${r.origin}' for comlink proxy`);return}const{id:a,type:l,path:u}=Object.assign({path:[]},r.data),o=(r.data.argumentList||[]).map(m);let s;try{const i=u.slice(0,-1).reduce((c,y)=>c[y],t),f=u.reduce((c,y)=>c[y],t);switch(l){case"GET":s=f;break;case"SET":i[u.slice(-1)[0]]=m(r.data.value),s=!0;break;case"APPLY":s=f.apply(i,o);break;case"CONSTRUCT":{const c=new f(...o);s=rt(c)}break;case"ENDPOINT":{const{port1:c,port2:y}=new MessageChannel;k(t,y),s=V(c,[c])}break;case"RELEASE":s=void 0;break;default:return}}catch(i){s={value:i,[b]:0}}Promise.resolve(s).catch(i=>({value:i,[b]:0})).then(i=>{const[f,c]=M(i);e.postMessage(Object.assign(Object.assign({},f),{id:a}),c),l==="RELEASE"&&(e.removeEventListener("message",g),I(e),S in t&&typeof t[S]=="function"&&t[S]())}).catch(i=>{const[f,c]=M({value:new TypeError("Unserializable return value"),[b]:0});e.postMessage(Object.assign(Object.assign({},f),{id:a}),c)})}),e.start&&e.start()}function Q(t){return t.constructor.name==="MessagePort"}function I(t){Q(t)&&t.close()}function Z(t,e){const n=new Map;return t.addEventListener("message",function(r){const{data:a}=r;if(!a||!a.id)return;const l=n.get(a.id);if(l)try{l(a)}finally{n.delete(a.id)}}),A(t,n,[],e)}function w(t){if(t)throw new Error("Proxy has been released and is not useable")}function q(t){return d(t,new Map,{type:"RELEASE"}).then(()=>{I(t)})}const _=new WeakMap,E="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(_.get(t)||0)-1;_.set(t,e),e===0&&q(t)});function tt(t,e){const n=(_.get(e)||0)+1;_.set(e,n),E&&E.register(t,e,t)}function et(t){E&&E.unregister(t)}function A(t,e,n=[],g=function(){}){let r=!1;const a=new Proxy(g,{get(l,u){if(w(r),u===$)return()=>{et(a),q(t),e.clear(),r=!0};if(u==="then"){if(n.length===0)return{then:()=>a};const o=d(t,e,{type:"GET",path:n.map(s=>s.toString())}).then(m);return o.then.bind(o)}return A(t,e,[...n,u])},set(l,u,o){w(r);const[s,i]=M(o);return d(t,e,{type:"SET",path:[...n,u].map(f=>f.toString()),value:s},i).then(m)},apply(l,u,o){w(r);const s=n[n.length-1];if(s===X)return d(t,e,{type:"ENDPOINT"}).then(m);if(s==="bind")return A(t,e,n.slice(0,-1));const[i,f]=W(o);return d(t,e,{type:"APPLY",path:n.map(c=>c.toString()),argumentList:i},f).then(m)},construct(l,u){w(r);const[o,s]=W(u);return d(t,e,{type:"CONSTRUCT",path:n.map(i=>i.toString()),argumentList:o},s).then(m)}});return tt(a,t),a}function nt(t){return Array.prototype.concat.apply([],t)}function W(t){const e=t.map(M);return[e.map(n=>n[0]),nt(e.map(n=>n[1]))]}const j=new WeakMap;function V(t,e){return j.set(t,e),t}function rt(t){return Object.assign(t,{[F]:!0})}function M(t){for(const[e,n]of H)if(n.canHandle(t)){const[g,r]=n.serialize(t);return[{type:"HANDLER",name:e,value:g},r]}return[{type:"RAW",value:t},j.get(t)||[]]}function m(t){switch(t.type){case"HANDLER":return H.get(t.name).deserialize(t.value);case"RAW":return t.value}}function d(t,e,n,g){return new Promise(r=>{const a=st();e.set(a,r),t.start&&t.start(),t.postMessage(Object.assign({id:a},n),g)})}function st(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}const at=t=>{const{perspective_point_height:e,semi_major_axis:n,semi_minor_axis:g,inverse_flattening:r,longitude_of_projection_origin:a}=t.globalAttributes,{x:l,y:u}=t.variables,o=parseFloat(e),s=parseFloat(n),i=parseFloat(g),f=parseFloat(a)*(Math.PI/180),c=o*o,y=s*s,v=i*i,R=new Float32Array(l.data.length),C=new Float32Array(l.data.length);for(let h=0;h<l.data.length;h++){const D=l.data[h],U=u.data[h],T=Math.sin(D),p=Math.cos(D),O=Math.sin(U),x=Math.cos(U),G=T*T+p*p*(x*x+y/v*O*O),N=-2*o*p*x,ot=c-y,P=(-N-Math.sqrt(N*N-4*G*ot))/(2*G);if(P>o*2){R[h]=NaN,C[h]=NaN;continue}const Y=P*p*x,z=-P*T,it=P*p*O,ct=Math.atan(y/v*(it/Math.sqrt(Math.pow(o-Y,2)+z*z))),lt=f-Math.atan(z/(o-Y));R[h]=ct*(180/Math.PI),C[h]=lt*(180/Math.PI)}return{lats:R,lons:C}};k({process:async t=>{console.log("Worker: Received dataset for geo calculation.");const{lats:e,lons:n}=at(t);return console.log("Worker: Calculation complete. Posting back results."),V({lats:e,lons:n},[e.buffer,n.buffer])}})})();
